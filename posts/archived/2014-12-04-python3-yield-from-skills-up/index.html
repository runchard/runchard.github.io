<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.988bb8790f6f9a47a363.css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}a{background-color:transparent}img{border-style:none}blockquote,h1,h2,h3,h4,h5,h6,hr,ol,p,ul{margin:0}ol,ul{list-style:none;padding:0}html{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}*,:after,:before{box-sizing:border-box;border:0 solid #e2e8f0}hr{border-top-width:1px}img{border-style:solid}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}img{display:block;vertical-align:middle;max-width:100%;height:auto}.bg-white{background-color:#fff}.bg-gray-100{background-color:#f7fafc}.bg-gray-200{background-color:#edf2f7}.border-solid{border-style:solid}.border{border-width:1px}.border-b-2{border-bottom-width:2px}.border-l-4{border-left-width:4px}.block{display:block}.inline-block{display:inline-block}.inline{display:inline}.flex{display:flex}.table{display:table}.items-center{align-items:center}.justify-end{justify-content:flex-end}.font-semibold{font-weight:600}.font-bold{font-weight:700}.h-auto{height:auto}.leading-4{line-height:1rem}.leading-6{line-height:1.5rem}.leading-8{line-height:2rem}.leading-9{line-height:2.25rem}.leading-10{line-height:2.5rem}.leading-tight{line-height:1.25}.list-inside{list-style-position:inside}.list-disc{list-style-type:disc}.list-decimal{list-style-type:decimal}.my-1{margin-top:.25rem;margin-bottom:.25rem}.mx-1{margin-left:.25rem;margin-right:.25rem}.my-2{margin-top:.5rem;margin-bottom:.5rem}.mx-2{margin-left:.5rem;margin-right:.5rem}.my-4{margin-top:1rem;margin-bottom:1rem}.my-5{margin-top:1.25rem;margin-bottom:1.25rem}.mx-auto{margin-left:auto;margin-right:auto}.mr-2{margin-right:.5rem}.mb-3{margin-bottom:.75rem}.mt-4{margin-top:1rem}.mt-5{margin-top:1.25rem}.mt-6{margin-top:1.5rem}.mt-10{margin-top:2.5rem}.mb-10{margin-bottom:2.5rem}.mb-24{margin-bottom:6rem}.max-w-full{max-width:100%}.min-h-screen{min-height:100vh}.p-1{padding:.25rem}.p-2{padding:.5rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.pt-4{padding-top:1rem}.pb-4{padding-bottom:1rem}.pl-8{padding-left:2rem}.table-fixed{table-layout:fixed}.text-gray-500{color:#a0aec0}.text-sm{font-size:.875rem}.text-lg{font-size:1.125rem}.text-xl{font-size:1.25rem}.text-2xl{font-size:1.5rem}.uppercase{text-transform:uppercase}.no-underline{text-decoration:none}.antialiased{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.tracking-wide{letter-spacing:.025em}.w-full{width:100%}@media (min-width:640px){.sm\:mx-4{margin-left:1rem;margin-right:1rem}}@media (min-width:768px){.md\:mt-0{margin-top:0}.md\:max-w-screen-md{max-width:768px}}code[class*=language-],pre[class*=language-]{color:#393a34;font-family:Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:.9em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;font-weight:700}pre>code[class*=language-]{font-size:1em}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{background:#c1def1}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#c1def1}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;background-color:#f5f5f5}:not(pre)>code[class*=language-]{padding:1px .2em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:green;font-style:italic}.token.namespace{opacity:.7}.token.string{color:#a31515}.token.operator,.token.punctuation{color:#393a34}.token.boolean,.token.constant,.token.inserted,.token.number,.token.symbol,.token.url,.token.variable{color:#36acaa}.language-autohotkey .token.selector,.language-json .token.boolean,.language-json .token.number,.token.atrule,.token.attr-value,.token.keyword,code[class*=language-css]{color:#00f}.token.function{color:#393a34}.language-autohotkey .token.tag,.token.deleted{color:#9a050f}.language-autohotkey .token.keyword,.token.selector{color:#00009f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.language-json .token.property,.token.class-name{color:#2b91af}.token.selector,.token.tag{color:maroon}.token.attr-name,.token.entity,.token.property,.token.regex{color:red}.token.directive.tag .tag{background:#ff0;color:#393a34}.line-numbers .line-numbers-rows{border-right-color:#a5a5a5}.line-numbers-rows>span:before{color:#2b91af}.line-highlight{background:rgba(193,222,241,.2);background:-webkit-linear-gradient(left,rgba(193,222,241,.2) 70%,rgba(221,222,241,0));background:linear-gradient(90deg,rgba(193,222,241,.2) 70%,rgba(221,222,241,0))}</style><meta name="generator" content="Gatsby 2.20.4"/><title data-rh="true">python3 yield from skills up</title><meta data-rh="true" name="twitter:card" content="summary_large_image"/><meta data-rh="true" name="twitter:site" content="@runchard"/><meta data-rh="true" name="twitter:creator" content="@runchard"/><meta data-rh="true" property="og:url" content="https://cccc.im/"/><meta data-rh="true" property="og:type" content="website"/><meta data-rh="true" property="og:locale" content="zh_CN"/><meta data-rh="true" property="og:site_name" content="Richard"/><meta data-rh="true" name="robots" content="index,follow"/><meta data-rh="true" name="googlebot" content="index,follow"/><script data-rh="true" type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage"
  },
  "headline": "python3 yield from skills up",
  "image": [],
  "datePublished": "2014-12-04T04:09:00.000Z",
  "dateModified": "2014-12-04T04:09:00.000Z",
  "author": {
    "@type": "Person",
    "name": "richard"
  },
  "publisher": {
    "@type": "Organization",
    "name": "https://cccc.im/favicon-180.png",
    "logo": {
      "@type": "ImageObject",
      "url": "CCCC IM"
    }
  }
}</script><link rel="alternate" type="application/rss+xml" title="Richard&#x27;s Shack" href="/rss.xml"/><link as="script" rel="preload" href="/webpack-runtime-5dc0b87e6c320ed512aa.js"/><link as="script" rel="preload" href="/styles-0fbe15c6518adcb30728.js"/><link as="script" rel="preload" href="/app-190c8009e55ed43976fb.js"/><link as="script" rel="preload" href="/commons-39a990eb6d3ebfaf7432.js"/><link as="script" rel="preload" href="/component---src-components-posts-page-layout-jsx-f19b8b36995ec77c7212.js"/><link as="fetch" rel="preload" href="/page-data/posts/archived/2014-12-04-python3-yield-from-skills-up/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="1qgajg6">.css-1qgajg6{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;line-height:1.25;min-height:100vh;width:100%;background-color:#fff;}</style><div class="css-1qgajg6"><style data-emotion-css="zgwyuu">.css-zgwyuu{margin-left:auto;margin-right:auto;margin-top:1.25rem;margin-bottom:1.25rem;}@media (min-width:768px){.css-zgwyuu{max-width:768px;}}</style><header class="css-zgwyuu"><style data-emotion-css="1bvc4cc">.css-1bvc4cc{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;}</style><nav class="css-1bvc4cc"><style data-emotion-css="3nyh0o">.css-3nyh0o{color:#0055FF;-webkit-text-decoration:none;text-decoration:none;text-transform:uppercase;-webkit-letter-spacing:0.025em;-moz-letter-spacing:0.025em;-ms-letter-spacing:0.025em;letter-spacing:0.025em;font-weight:700;font-size:1.25rem;margin-left:auto;margin-right:auto;}@media (min-width:640px){.css-3nyh0o{margin-left:1rem;margin-right:1rem;}}</style><a class="css-3nyh0o" href="/">Blogs</a><a class="css-3nyh0o" href="/tags">Tags</a><a class="css-3nyh0o" href="/about">About</a></nav></header><style data-emotion-css="ab9kzi">.css-ab9kzi{margin-left:auto;margin-right:auto;}@media (min-width:768px){.css-ab9kzi{max-width:768px;}}</style><div class="css-ab9kzi"><style data-emotion-css="1e4xsx5">.css-1e4xsx5{margin-top:1rem;margin-left:0.5rem;margin-right:0.5rem;margin-bottom:6rem;}@media (min-width:768px){.css-1e4xsx5{margin-top:0;}}</style><main class="css-1e4xsx5"><style data-emotion-css="1m2j4zd">.css-1m2j4zd{font-size:1.5rem;line-height:2.5rem;font-weight:700;margin-top:1.5rem;}</style><h1 class="css-1m2j4zd e1qygzsj1">python3 yield from skills up</h1><span></span><a href="/tags/python/"><style data-emotion-css="1b8im41">.css-1b8im41{display:inline;background-color:#eeeeee;font-size:0.875rem;color:#0055FF;padding-left:0.75rem;padding-right:0.75rem;padding-top:0.25rem;padding-bottom:0.25rem;font-weight:600;margin-right:0.5rem;}</style><span class="css-1b8im41">#<!-- -->python</span></a><a href="/tags/coroutine/"><span class="css-1b8im41">#<!-- -->coroutine</span></a><div>at <time>12/4/2014</time></div><style data-emotion-css="wnfmz2">.css-wnfmz2{border-width:1px;margin-top:0.5rem;margin-bottom:0.5rem;}</style><hr class="css-wnfmz2"/><h1 class="css-1m2j4zd e1qygzsj1">python3 yield from skills up<style data-emotion-css="12rknwd">.css-12rknwd{color:#0055FF;display:inline-block;}</style><a id="sec-1" class="css-12rknwd e1qygzsj0"></a></h1><style data-emotion-css="4q5fpo">.css-4q5fpo{line-height:1.5rem;padding-bottom:1rem;}</style><p class="css-4q5fpo e1qygzsj15">The explanation that yield from g is equivalent to for v in g: yield v does not even begin to do justice to what yield from is all about. Because, let&#x27;s face it, if all yield from does is expand the for loop, then it does not warrant adding yield from to the language and preclude a whole bunch of new features from being implemented in Python 2.x.
Think of yield from as providing a transparent two-way channel from the caller to the sub-generator.</p><style data-emotion-css="1engbwf">.css-1engbwf{font-size:1.25rem;line-height:2.25rem;font-weight:700;margin-top:1.25rem;}</style><h2 class="css-1engbwf e1qygzsj2">sending data to a generator using yield from<a id="sec-1-1" class="css-12rknwd e1qygzsj0"></a></h2><div class="gatsby-highlight" data-language="text"><pre style="counter-reset:linenumber NaN" class="language-text line-numbers"><code class="language-text">def generator():
    &quot;&quot;&quot;
    A generator(coroutine) that writes data *sent* to it to fd, socket, etc.
    &quot;&quot;&quot;
    while True:
        w = (yield)
        print(&#x27;&gt;&gt; %s&#x27; % w)


def gen_wrapper(c):          # c for coroutine
    yield from c

if __name__ == &#x27;__main__&#x27;:
    gen = generator()
    wrap = gen_wrapper(gen)
    wrap.send(None)  # initialize the coroutine
    for i in range(4):
        gen.send(i)</code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><h2 class="css-1engbwf e1qygzsj2">exception handling for yield from<a id="sec-1-2" class="css-12rknwd e1qygzsj0"></a></h2><div class="gatsby-highlight" data-language="text"><pre style="counter-reset:linenumber NaN" class="language-text line-numbers"><code class="language-text">class TransactionException(Exception):
    pass


def generator():
    while True:
        try:
            w = (yield)
        except TransactionException:
            print(&#x27;******&#x27;)
        else:
            print(&#x27;&gt;&gt; &#x27;, w)


def gen_wrapper(c):          # c for coroutine
    yield from c


if __name__ == &#x27;__main__&#x27;:
    gen = generator()
    wrap = gen_wrapper(gen)
    wrap.send(None)
    for i in [0, 1, 2, 3, &#x27;exc&#x27;, 4]:
        if i == &#x27;exc&#x27;:
            wrap.throw(TransactionException)
        else:
            wrap.send(i)</code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><h2 class="css-1engbwf e1qygzsj2">close outside of block<a id="sec-1-3" class="css-12rknwd e1qygzsj0"></a></h2><div class="gatsby-highlight" data-language="text"><pre style="counter-reset:linenumber NaN" class="language-text line-numbers"><code class="language-text">def generator():
    while True:
        w = (yield)
        print(&#x27;&gt;&gt; &#x27;, w)


def gen_wrapper(c):          # c for coroutine
    yield from c


if __name__ == &#x27;__main__&#x27;:
    gen = generator()
    wrap = gen_wrapper(gen)
    wrap.send(None)
    for i in [0, 1, 2, 3, &#x27;close&#x27;, 4]:
        if i == &#x27;close&#x27;:
            wrap.close()
        else:
            wrap.send(i)</code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><h2 class="css-1engbwf e1qygzsj2">benefits of yield<a id="sec-1-4" class="css-12rknwd e1qygzsj0"></a></h2><style data-emotion-css="m2cdcs">.css-m2cdcs{padding-left:2rem;margin-bottom:0.75rem;list-style-type:disc;list-style-position:inside;}</style><ul class="css-m2cdcs e1qygzsj8"><li>Using a generalization of the StopIteration exception makes it easy for other kinds of iterators to participate in the protocol without having to grow an extra attribute or a close() method.</li><li>It simplifies the implementation, because the point at which the return value from the subgenerator becomes available is the same point at which the exception is raised. Delaying until any later time would require storing the return value somewhere.</li><li>the primary benefits of yield from come when you&#x27;ve written a generator that uses these techniques and when it needs to be refactored.</li></ul><p class="css-4q5fpo e1qygzsj15">and especially this part: <a href="https://www.python.org/dev/peps/pep-0380/#generators-as-threads" class="css-12rknwd e1qygzsj0">https://www.python.org/dev/peps/pep-0380/#generators-as-threads</a></p><h2 class="css-1engbwf e1qygzsj2"><code class="language-text">coroutine</code> is not a <code class="language-text">callback</code> (which is <code class="language-text">yield</code> is not a <code class="language-text">function</code>)<a id="sec-1-5" class="css-12rknwd e1qygzsj0"></a></h2><p class="css-4q5fpo e1qygzsj15">The difference is that whenever the generator &quot;yields&quot; a value the execution of the generator is paused and the code continues where the generator was called.</p><h1 class="css-1m2j4zd e1qygzsj1">reference<a id="sec-2" class="css-12rknwd e1qygzsj0"></a></h1><p class="css-4q5fpo e1qygzsj15"><a href="http://legacy.python.org/dev/peps/pep-0380/" class="css-12rknwd e1qygzsj0">http://legacy.python.org/dev/peps/pep-0380/</a>
<a href="http://legacy.python.org/dev/peps/pep-0342/" class="css-12rknwd e1qygzsj0">http://legacy.python.org/dev/peps/pep-0342/</a>
<a href="http://stackoverflows.com" class="css-12rknwd e1qygzsj0">http://stackoverflows.com</a></p><ul class="css-m2cdcs e1qygzsj8"><li>speacial great thanks to <a href="about.me/fantix" class="css-12rknwd e1qygzsj0">@Fantix King</a></li></ul><style data-emotion-css="k008qs">.css-k008qs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}</style><div class="css-k008qs"><style data-emotion-css="df9niz">.css-df9niz{margin-left:0.25rem;margin-right:0.25rem;margin-top:2.5rem;padding-left:0.75rem;padding-right:0.75rem;padding-top:0.5rem;padding-bottom:0.5rem;background-color:#f5f5f5;color:#9e9e9e;}</style><div class="css-df9niz"><style data-emotion-css="1u0m9x5">.css-1u0m9x5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;color:#0055FF;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-weight:600;}</style><a class="css-1u0m9x5" href="/posts/archived/2014-11-12-link-post/"><style data-emotion-css="ubv93r">.css-ubv93r{margin-left:0.25rem;margin-right:0.25rem;}</style><span class="css-ubv93r">«<!-- --> <!-- -->Link post<!-- --> </span></a></div><div class="css-df9niz"><a class="css-1u0m9x5" href="/posts/archived/2015-09-07-pro-evernote/"><span class="css-ubv93r"> <!-- -->Pro Evernote<!-- --> <!-- -->»</span></a></div></div></main></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/archived/2014-12-04-python3-yield-from-skills-up/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-190c8009e55ed43976fb.js"],"component---src-components-taggroup-layout-jsx":["/component---src-components-taggroup-layout-jsx-7730890ef0230a7e396e.js"],"component---src-components-posts-page-layout-jsx":["/component---src-components-posts-page-layout-jsx-f19b8b36995ec77c7212.js"],"component---src-pages-404-jsx":["/component---src-pages-404-jsx-9de3a7b482c70cced426.js"],"component---src-pages-about-jsx":["/component---src-pages-about-jsx-bd6f8131e203fe1d2fed.js"],"component---src-pages-index-jsx":["/component---src-pages-index-jsx-c73c1b1765b07858ba64.js"],"component---src-pages-tags-jsx":["/component---src-pages-tags-jsx-61c4b8c8a8b2d1d071bb.js"]};/*]]>*/</script><script src="/component---src-components-posts-page-layout-jsx-f19b8b36995ec77c7212.js" async=""></script><script src="/commons-39a990eb6d3ebfaf7432.js" async=""></script><script src="/app-190c8009e55ed43976fb.js" async=""></script><script src="/styles-0fbe15c6518adcb30728.js" async=""></script><script src="/webpack-runtime-5dc0b87e6c320ed512aa.js" async=""></script></body></html>